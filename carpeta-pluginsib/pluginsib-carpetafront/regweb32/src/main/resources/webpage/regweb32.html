<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
      xml:lang="${lang}" lang="${lang}">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>${title}</title>
    <link rel="shortcut icon" type="image/x-ico" href="http://www.caib.es/sites/favicon.png">
<!--    <meta http-equiv="Content-Language" content="${lang}">-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="_csrf" content="">
    <meta name="_csrf_header" content="">
    <!-- SCRIPTS -->
    <script src="${resources}/carpeta/jquery-3.5.0.js"></script>
    <script src="${resources}/carpeta/popper.min.js"></script>
    <script src="${resources}/carpeta/bootstrap.min.js"></script>
    <!-- DataTables -->
    <script src="${resources}/carpeta/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="${resources}/carpeta/moment-with-locales.min.js"></script>
    <script src="${resources}/carpeta/datetime-moment.js" type="text/javascript"></script>
    <!-- ESTILS -->
    <link href="${resources}/carpeta/bootstrap.min.css" rel="stylesheet">
    <link href="${resources}/carpeta/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link href="${resources}/carpeta/goib.css" rel="stylesheet">
    <link href="${resources}/carpeta/carpeta.css" rel="stylesheet">
    <link href="${resources}/carpeta/open-iconic-bootstrap.css" rel="stylesheet">
    <link href="${resources}/carpeta/jquery.dataTables.min.css" rel="stylesheet">
    <link href="${resources}/carpeta/datatables.min.css" rel="stylesheet">
    <script type="text/javascript">
        var head  = document.getElementsByTagName('head')[0];
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = sessionStorage.getItem("cssExtern");
        head.appendChild(link);
    </script>
</head>


<body class="fonsPlugin" >
<div id="carregantDetallRegistre" class="loader-container centrat loaderOcult" role="alert">
    <div class="loader"></div>
</div>
<div id="llistat" class="container-contenido">
    <div class="infoNoMenu">
        <h2 class="titol h2">${registro_listado}</h2>

        <div class="col-md-12 border-0 float-left p-0">
            <p class="lh15 text-estrofa subtitol">${registro_descripcion}</p>
            <div class="card-body tablaRegistros">
            
                <form id="fechaBusqueda" action="${form_action}" method="post">
                    <div class="row pb-2 ml-0 mr-0">
                        <div class="col-md-3 pl-0 pr-8 form-mobil">
                            <div class="form-group pr-2" style="padding-right:50px">
                                <label for="numero" class="float-left">${registro_numero}</label>
                                <input type="text" name="numero" id="numero" placeholder="${registro_numero}" maxlength="25" aria-labelledby="numero" class="form-control form-control-sm camp-form-mobil focusIn" value="<#if form_numero?has_content>${form_numero}</#if>" tabindex="501" style="width:100%;"/>
                            </div>
                        </div>
                    
                        <div class="col-md-3 pl-0 form-mobil">
                            <div class="form-group pl-0 pr-4 form-mobil">
                                <label for="fechaInicio" class="float-left">${carpeta_fecha_inicio}</label>
                                <div class="input-group input-group-fecha-inicio">
                                    <input id="fechaInicio" name="fechaInicio" class="form-control form-control-sm estilCalendar focusIn"
                                           required="required" type="date" value="${form_dataInici?string('yyyy-MM-dd')}" 
                                           min="1900-01-01" max="2100-12-31"
                                           tabindex="502" aria-labelledby="fechaInicio">
                                    <span class="input-group-text"><span class="oi oi-calendar"></span></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 pl-0 form-mobil">
                            <div class="form-group pr-4 form-mobil">
                                <label for="fechaFin" class="float-left">${carpeta_fecha_fin}</label>
                                <div class="input-group input-group-fecha-fin">
                                    <input id="fechaFin" name="fechaFin" class="form-control form-control-sm estilCalendar focusIn"
                                           required="required" type="date" value="${form_dataFi?string('yyyy-MM-dd')}"
                                           min="1900-01-01" max="2100-12-31" 
                                           tabindex="503" aria-labelledby="fechaFin">
                                    <span class="input-group-text"><span class="oi oi-calendar"></span></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 pl-0 pr-0">
                            <div class="form-group pr-4">
                                <label for="estado" class="float-left">${registro_estado}</label>
                                <select name="estado" id="estado" class="form-control form-control-sm focusIn" tabindex="504" aria-labelledby="estado">
                                    <#list registroEstadoSelect as regEstado >
                                    <option value="${regEstado?index}" <#if form_estat == regEstado?index?c>selected="selected"</#if> >${regEstado}</option>
                                    </#list>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="errorContainer" class="row pb-2 ml-0 mr-0 ocult">
                        <div class="alert alert-warning" role="alert" id="errorMsg"></div>
                    </div>
                    <button type="submit" class="btn btn-primary carpeta-btn ml-0 float-left" onclick="validaFormulari();return false;" tabindex="505">${carpeta_buscar}</button>
                </form>

                <#if registros?has_content>
                <div class="mt-5 taula-mobil">
                    <table id="dataTable_paginate" class="table table-striped table-bordered table-hover"
                           style="width:100%">
                        <thead class="table-success">
                        <tr>
                            <th>${registro_numero}</th>
                            <th style="width:120px !important">${registro_fecha}</th>
                            <th>${registro_extracto}</th>
                            <th>${registro_estado}</th>
                            <th>${registro_destinatario}</th>
                        </tr>
                        </thead>
                        <tbody>
                        <#setting date_format="MM/dd/yyyy hh">
                        <#list registros as registroItem >

                        <tr class="clickable-row" onclick="mostrantDetall('${registroItem.numeroRegistro}')" onkeypress="mostrantDetall('${registroItem.numeroRegistro}')" tabindex="511">
                            <td class="totLinia">${registroItem.numeroRegistro}</td>
                            <td class="totLinia" data-order="$registroItem.fechaRegistro?string('yyyyMMddHHmm')}">
                                ${registroItem.fechaRegistro?string("dd-MM-yyyy HH:mm")}
                            </td>
                            <td>
                                <label data-toggle="tooltip" data-placement="top" title="${registroItem.extracto}">
                                    <input type="hidden" class="tallarExtracte">${registroItem.extracto}</input>
                                </label>
                            </td>
                            <td>
                                <#if registroItem.estado?has_content >
                                <label data-toggle="tooltipDetall" data-placement="top" title="${registroExplicacionEstado[registroItem.estado]}">
                                    <input type="hidden">${registroEstado[registroItem.estado]}</input>
                                </label>
                                <#else>
                                <p>${registroEstado[1]}</p>
                                </#if>
                            </td>
                            <td>${registroItem.denominacionDestino}</td>
                        </tr>
                        </#list>
                        </tbody>
                    </table>
                    <script type="text/javascript">
                        $(document).ready(function () {
                            $.fn.dataTable.moment('DD/MM/YYY HH:mm');
                        });

                        $(function () {
                            $('[data-toggle="tooltip"]').tooltip();
                            $('[data-toggle="tooltipDetall"]').tooltip();
                        })
                    </script>



                    <div class="row"  style="width:100%; text-align:center;" >

                        <div class="col-4" style="float:left;" ></div>

                        <div class="col-4">

                            <nav aria-label="Page navigation">
                                <ul class="pagination pagination-sm center">

                                    <#if paginacio.currentIndex==0>

                                        <li class="page-item disabled"><a class="page-link" href="#"><<</a></li>
                                        <li class="page-item disabled"><a class="page-link" href="#"><</a></li>

                                    </#if>
                                    <#if paginacio.currentIndex!=0>

                                        <li class="page-item"><a class="page-link" onclick="espera();" href="${firstUrl}" ><<</a></li>
                                        <li class="page-item"><a class="page-link" onclick="espera();" href="${prevUrl}" ><</a></li>

                                    </#if>

                                    <#list paginacio.beginIndex..paginacio.endIndex as j>
                                         <#if paginacio.currentIndex==j-1>
                                             <li class="page-item active"><a class="page-link" onclick="espera();" href="#">${j}</a></li>
                                         </#if>
                                         <#if paginacio.currentIndex!=j-1>
                                             <li  class="page-item"><a class="page-link" onclick="espera();" href="${pageUrl}${j}">${j}</a></li>
                                         </#if>
                                    </#list>

                                    <#if paginacio.currentIndex==paginacio.totalPages-1>
                                        <li  class="page-item disabled"><a class="page-link"  href="#"> &gt;</a></li>
                                        <li  class="page-item disabled"><a class="page-link"  href="#">&gt;&gt;</a></li>
                                    </#if>

                                    <#if paginacio.currentIndex!=paginacio.totalPages-1>
                                        <li class="page-item"><a class="page-link" href="${nextUrl}" onclick="espera();" >&gt;</a></li>
                                        <li class="page-item"><a class="page-link" href="${lastUrl}" onclick="espera();" >&gt;&gt;</a></li>
                                    </#if>

                                </ul>
                            </nav>
                       </div>
                    </div>

                <#elseif cerca?has_content>
                    <div class="alert alert-secondary mt-5" role="alert">
                        ${registro_vacio}
                    </div>
                </#if>
        </div>
    </div>
    <div class="col-md-12 border-0 float-left p-0" id="botoTornarRegweb" style="margin-top: 20px">
        <button type="button" data-toggle="modal" class="botoSuport" tabindex="520" aria-labelledby="botoTornarRegweb" onclick="parent.location.href=sessionStorage.getItem('pagTornar');">${boto_tornar}</button>
    </div>
</div>
</div>
<script type="text/javascript">

        function espera() {
           $('#llistat').hide();
           $("#carregantDetallRegistre").removeClass("loaderOcult");
        }

        function mostrantDetall(numeroRegistroFormateado){
            espera();
            window.location.replace('${urlDetalle}'+numeroRegistroFormateado);
        }
        
        function validarFecha(obj) {
            if (isNaN(Date.parse(obj.val()))){
                $('#errorMsg').html("${error_data}");
                $('#errorContainer').removeClass("ocult");
                obj.css('border','1px solid red');
                return false;
            }else{
                $('#errorContainer').addClass("ocult");
                obj.css('border','none');
                return true;
            }
        }
        
        function validaFormulari(){

            posarFocus();
        	
        	if(!validarFecha($('#fechaInicio')) || !validarFecha($('#fechaFin'))){
        		return false;
        	} 
        	
        	if($('#fechaInicio').val() <= $('#fechaFin').val()){
        		$('#llistat').hide();
                $("#carregantDetallRegistre").removeClass("loaderOcult");
                $('#fechaBusqueda').submit();
        		return true;
        	}
        	$('#errorMsg').html("${error_dates}");
            $('#errorContainer').removeClass("ocult");
            $('.input-group-fecha-inicio').css('border','1px solid red');
            $('.input-group-fecha-fin').css('border','1px solid red');
        	return false;
        }

        function posarFocus() {
            const enfocar = parent.document.getElementById("fullpagecarpetafront");
            enfocar.focus();
        }
        
        $(document).ready(function () {
        	$(".input-group-fecha-fin .oi-calendar").click(function(){ 
                $('#fechaFin').focus(); 
            });
            
            $(".input-group-fecha-inicio .oi-calendar").click(function(){ 
                $('#fechaInicio').focus(); 
            });
            
            if (navigator.appVersion.indexOf("Chrome/") != -1) {
                $('.input-group-fecha-inicio .input-group-text').css('display','none');
                $('.input-group-fecha-fin .input-group-text').css('display','none');
            }
            
            $('#fechaInicio').blur(function(e){ 
            	e.preventDefault();
            	validarFecha($(this));
            });
            
            $('#fechaFin').blur(function(e){
            	e.preventDefault();
            	validarFecha($(this));	
            });
            
        });
        
    </script>
</body>
</html>