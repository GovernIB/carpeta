<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ca" lang="ca">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>${title}</title>
    <link rel="shortcut icon" type="image/x-ico" href="http://www.caib.es/sites/favicon.png">
    <meta http-equiv="Content-Language" content="ca">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="_csrf" content="">
    <meta name="_csrf_header" content="">
    <!-- SCRIPTS -->
    <script src="${resources}/carpeta/jquery-3.5.0.js"></script>
    <script src="${resources}/carpeta/popper.min.js"></script>
    <script src="${resources}/carpeta/bootstrap.min.js"></script>
    <!-- Datetimepicker -->
    <script src="${resources}/carpeta/moment-with-locales.min.js"></script>
    <script src="${resources}/carpeta/bootstrap-datetimepicker.js"></script>
    <!-- Del Goib -->
    <!--    <script src="${resources}/carpeta/globales.js" type="text/javascript"></script>-->
    <!-- DataTables -->
    <script src="${resources}/carpeta/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="${resources}/carpeta/datetime-moment.js" type="text/javascript"></script>
    <!-- ESTILS -->
    <link href="${resources}/carpeta/bootstrap.min.css" rel="stylesheet">
    <link href="${resources}/carpeta/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link href="${resources}/carpeta/goib.css" rel="stylesheet">
    <link href="${resources}/carpeta/carpeta.css" rel="stylesheet">
    <link href="${resources}/carpeta/open-iconic-bootstrap.css" rel="stylesheet">
    <link href="${resources}/carpeta/jquery.dataTables.min.css" rel="stylesheet">
    <link href="${resources}/carpeta/datatables.min.css" rel="stylesheet">
</head>
<body class="fonsPlugin" >
<div id="carregantDetallRegistre" class="loader-container centrat loaderOcult">
    <div class="loader"></div>
</div>
<div id="llistat" class="container-contenido">
    <div class="infoNoMenu">
        <h2><p class="titol h2">${registro_listado}</p></h2>

        <div class="col-md-12 border-0 float-left p-0">
            <p class="lh15 text-estrofa">${registro_descripcion}</p>
            <div class="card-body tablaRegistros">
            
                <form id="fechaBusqueda" action="" method="post">
                    <div class="row pb-2 ml-0 mr-0">
                        <div class="col-md-2">
                            <div class="form-group pl-2 pr-2" style="padding-right:50px">
                                <label for="numero" class="float-left">${registro_numero}</label>
                                <input type="text" name="numero" id="numero" class="form-control form-control-sm" value="<#if form_numero?has_content>${form_numero}</#if>" />
                            </div>
                        </div>
                    
                        <div class="col-md-2">
                            <div class="form-group pl-0 pr-2">
                                <label for="fechaInicio" placeholder="dd/mm/yyyy" class="float-left">${carpeta_fecha_inicio}</label>
                                <div class="input-group">
                                    <input id="fechaInicio" name="fechaInicio" class="form-control form-control-sm"
                                           required="required" type="text"
                                           value="${form_dataInici?string('dd/MM/yyyy')}" maxlength="10">
                                    <span class="input-group-text"><span class="oi oi-calendar"></span></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group pl-2 pr-2">
                                <label for="fechaFin" placeholder="dd/mm/yyyy" class="float-left">${carpeta_fecha_fin}</label>
                                <div class="input-group">
                                    <input id="fechaFin" name="fechaFin" class="form-control form-control-sm" required="required" type="text" value="${form_dataFi?string('dd/MM/yyyy')}" maxlength="10">
                                    <span class="input-group-text"><span class="oi oi-calendar"></span></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group pl-2 pr-2">
                                <label for="estado" class="float-left">${registro_estado}</label>
                                <select name="estado" id="estado" class="form-control form-control-sm">
                                    <#list registroEstadoSelect as regEstado >
                                    <option value="${regEstado?index}" <#if form_estat == regEstado?index?c>selected="selected"</#if> >${regEstado}</option>
                                    </#list>
                                </select>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary carpeta-btn ml-0 float-left" onclick="espera()">${carpeta_buscar}</button>
                </form>

                <#if registros?has_content>
                <div class="mt-5">
                    <table id="dataTable_paginate" class="table table-striped table-bordered table-hover"
                           style="width:100%">
                        <thead class="table-success">
                        <tr>
                            <th>${registro_numero}</th>
                            <th style="width:120px !important">${registro_fecha}</th>
                            <th>${registro_extracto}</th>
                            <th>${registro_estado}</th>
                            <th>${registro_destinatario}</th>
                        </tr>
                        </thead>
                        <tbody>
                        <#setting date_format="MM/dd/yyyy hh">
                        <#list registros as registroItem >

                        <tr class="clickable-row"  onclick="mostrantDetall('${registroItem.numeroRegistro}')">
                            <td class="totLinia">${registroItem.numeroRegistro}</td>
                            <td class="totLinia" data-order="$registroItem.fechaRegistro?string('yyyyMMddHHmm')}">
                                ${registroItem.fechaRegistro?string("dd-MM-yyyy HH:mm")}
                            </td>
                            <td>
                                <label data-toggle="tooltip" data-placement="top" title="${registroItem.extracto}">
                                    <p class="tallarExtracte">${registroItem.extracto}</p>
                                </label>
                            </td>
                            <td>
                                <#if registroItem.estado?has_content >
                                <label data-toggle="tooltipDetall" data-placement="top" title="${registroExplicacionEstado[registroItem.estado]}">
                                    <p>${registroEstado[registroItem.estado]}</p>
                                </label>
                                <#else>
                                <p>${registroEstado[1]}</p>
                                </#if>
                            </td>
                            <td>${registroItem.denominacionDestino}</td>
                        </tr>
                        </#list>
                        </tbody>
                    </table>
                    <script type="text/javascript">
                        $(document).ready(function () {
                            $.fn.dataTable.moment('DD/MM/YYY HH:mm');
                        });

                        $(function () {
                            $('[data-toggle="tooltip"]').tooltip();
                            $('[data-toggle="tooltipDetall"]').tooltip();
                        })
                    </script>



                    <div class="row"  style="width:100%; text-align:center;" >

                        <div class="col-4" style="float:left;" ></div>

                        <div class="col-4">

                            <nav aria-label="Page navigation">
                                <ul class="pagination pagination-sm center">

                                    <#if paginacio.currentIndex==0>

                                        <li class="page-item disabled"><a class="page-link" href="#"><<</a></li>
                                        <li class="page-item disabled"><a class="page-link" href="#"><</a></li>

                                    </#if>
                                    <#if paginacio.currentIndex!=0>

                                        <li class="page-item"><a class="page-link" onclick="espera();" href="${firstUrl}" ><<</a></li>
                                        <li class="page-item"><a class="page-link" onclick="espera();" href="${prevUrl}" ><</a></li>

                                    </#if>

                                    <#list paginacio.beginIndex..paginacio.endIndex as j>
                                         <#if paginacio.currentIndex==j-1>
                                             <li class="page-item active"><a class="page-link" onclick="espera();" href="#">${j}</a></li>
                                         </#if>
                                         <#if paginacio.currentIndex!=j-1>
                                             <li  class="page-item"><a class="page-link" onclick="espera();" href="${pageUrl}${j}">${j}</a></li>
                                         </#if>

                                    </#list>


                                    <#if paginacio.currentIndex==paginacio.totalPages-1>
                                        <li  class="page-item disabled"><a class="page-link"  href="#"> &gt;</a></li>
                                        <li  class="page-item disabled"><a class="page-link"  href="#">&gt;&gt;</a></li>
                                    </#if>

                                    <#if paginacio.currentIndex!=paginacio.totalPages-1>
                                        <li class="page-item"><a class="page-link" href="${nextUrl}" onclick="espera();" >&gt;</a></li>
                                        <li class="page-item"><a class="page-link" href="${lastUrl}" onclick="espera();" >&gt;&gt;</a></li>
                                    </#if>

                                </ul>
                            </nav>
                       </div>
                    </div>

                <#else>
                    <div class="alert alert-secondary mt-5" role="alert">
                        ${registro_vacio}
                    </div>
                </#if>
        </div>
    </div>
</div>
</div>
<script type="text/javascript">

        function espera() {
           $('#llistat').hide();
           $("#carregantDetallRegistre").removeClass("loaderOcult");
        }


        function mostrantDetall(numeroRegistroFormateado){
            espera();
            window.location.replace('${urlDetalle}'+numeroRegistroFormateado);
        }
       
        /**  DATEPICKER **/
        $(function() {
            $('#fechaInicio').datetimepicker({
                locale: 'ca',
                showClose: false,
                format: 'D/MM/YYYY',
                icons: {
                    time: 'oi oi-clock',
                    date: 'oi oi-calendar',
                    previous: 'oi oi-chevron-left',
                    next: 'oi oi-chevron-right',
                    close: 'oi oi-circle-x'
                },
                tooltips: {
                    selectMonth: 'Selecciona mes',
                    prevMonth: 'Mes anterior',
                    nextMonth: 'Mes siguiente'
                }
            });
        });

        $(function() {
            $('#fechaFin').datetimepicker({
                locale: 'ca',
                showClose: false,
                format: 'D/MM/YYYY',
                icons: {
                    time: 'oi oi-clock',
                    date: 'oi oi-calendar',
                    previous: 'oi oi-chevron-left',
                    next: 'oi oi-chevron-right',
                    close: 'oi oi-circle-x'
                },
                tooltips: {
                    selectMonth: 'Selecciona mes',
                    prevMonth: 'Mes anterior',
                    nextMonth: 'Mes siguiente'
                }
            });
        });
        
    </script>
</body>
</html>
